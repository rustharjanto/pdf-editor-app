(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();class T{constructor(e){this.pdfDoc=null,this.currentPage=1,this.scale=1,this.minScale=.5,this.maxScale=3,this.pdfEditor=e,this.totalPages=0,this.pagesContainer=null,this.pdfUrl=null,console.log("PDFViewer initialized")}async loadPDF(e){try{if(console.log("Loading PDF file:",e.name),!e||e.type!=="application/pdf")throw new Error("File harus PDF");if(this.showLoading(!0),this.clear(),typeof window>"u"||!window.pdfjsLib)throw new Error("PDF.js library not loaded");const t=window.pdfjsLib;if(this.pdfUrl=URL.createObjectURL(e),this.pdfDoc=await t.getDocument({url:this.pdfUrl,enableXfa:!0}).promise,this.totalPages=this.pdfDoc.numPages,console.log("PDF loaded, pages:",this.totalPages),this.pagesContainer=document.getElementById("pagesContainer"),!this.pagesContainer)throw new Error("Pages container not found");if(await this.renderAllPages(t),this.pdfEditor&&this.pdfEditor.setPDFData){const i=await this.readFileAsArrayBuffer(e),n=new Uint8Array(i);this.pdfEditor.setPDFData(n)}return!0}catch(t){throw console.error("Failed to load PDF:",t),t}finally{this.showLoading(!1)}}async renderAllPages(e){if(!(!this.pdfDoc||!this.pagesContainer||!e)){console.log("Rendering all pages..."),this.pagesContainer.innerHTML="";for(let t=1;t<=this.totalPages;t++)await this.renderPage(t,e);console.log("All pages rendered")}}async renderPage(e,t){if(!(!this.pdfDoc||!t))try{console.log(`Rendering page ${e}...`);const i=await this.pdfDoc.getPage(e),n=i.getViewport({scale:this.scale}),s=document.createElement("div");s.className="relative bg-white shadow-lg mx-auto",s.id=`page-${e}`,s.style.width=`${n.width}px`,s.style.height=`${n.height}px`,s.setAttribute("data-page",e);const r=document.createElement("canvas");r.className="absolute top-0 left-0",r.id=`pdfCanvas-${e}`;const l=window.devicePixelRatio||1;r.width=Math.floor(n.width*l),r.height=Math.floor(n.height*l),r.style.width=`${n.width}px`,r.style.height=`${n.height}px`;const a=r.getContext("2d");a.scale(l,l);const c=document.createElement("canvas");c.className="page-overlay absolute top-0 left-0",c.id=`overlayCanvas-${e}`,c.width=Math.floor(n.width*l),c.height=Math.floor(n.height*l),c.style.width=`${n.width}px`,c.style.height=`${n.height}px`,c.style.pointerEvents="none",c.setAttribute("data-page",e),c.getContext("2d").scale(l,l);const d={canvasContext:a,viewport:n};await i.render(d).promise,s.appendChild(r),s.appendChild(c),this.pagesContainer.appendChild(s);const h={width:n.width,height:n.height,scale:this.scale,dpr:l};this.pdfEditor&&this.pdfEditor.setPageViewport&&this.pdfEditor.setPageViewport(e,h),console.log(`Page ${e} rendered at scale ${this.scale}`)}catch(i){console.error(`Error rendering page ${e}:`,i)}}readFileAsArrayBuffer(e){return new Promise((t,i)=>{const n=new FileReader;n.onload=()=>{n.result?t(n.result):i(new Error("FileReader result is null"))},n.onerror=()=>{i(new Error("Failed to read file"))},n.onabort=()=>{i(new Error("File reading aborted"))};try{n.readAsArrayBuffer(e)}catch(s){i(s)}})}clear(){console.log("Clearing PDF viewer"),this.pdfUrl&&(URL.revokeObjectURL(this.pdfUrl),this.pdfUrl=null),this.pagesContainer&&(this.pagesContainer.innerHTML=""),this.pdfDoc=null,this.currentPage=1,this.scale=1,this.totalPages=0}showLoading(e){const t=document.getElementById("loadingOverlay");t&&t.classList.toggle("hidden",!e)}}const I="modulepreload",M=function(o){return"/pdf-editor-app/"+o},D={},k=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=Promise.allSettled(t.map(a=>{if(a=M(a),a in D)return;D[a]=!0;const c=a.endsWith(".css"),g=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${g}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":I,c||(d.as="script"),d.crossOrigin="",d.href=a,l&&d.setAttribute("nonce",l),document.head.appendChild(d),c)return new Promise((h,m)=>{d.addEventListener("load",h),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return n.then(r=>{for(const l of r||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})};class S{constructor(){this.annotations=[],this.history=[],this.historyIndex=-1,this.currentColor="#000000",this.currentMode=null,this.isEditMode=!1,this.pdfData=null,this.pageViewports=new Map,this.currentPage=1,this.currentScale=1,this.drawingPoints=[],this.isDrawing=!1,this.pendingText=null,this.currentFontSize=20,this.currentBrushSize=2,this.pageOverlays=new Map,console.log("PDFEditor initialized"),this.bindCanvasEvents()}bindCanvasEvents(){document.addEventListener("pointerdown",e=>{if(!this.isEditMode||this.currentMode!=="draw")return;const t=e.target.closest(".page-overlay");if(!t)return;e.preventDefault(),e.stopPropagation();const i=parseInt(t.getAttribute("data-page"));this.startDrawing(e,i,t)}),document.addEventListener("pointermove",e=>{!this.isEditMode||!this.isDrawing||(e.preventDefault(),e.stopPropagation(),this.continueDrawing(e))}),document.addEventListener("pointerup",e=>{!this.isEditMode||!this.isDrawing||(e.preventDefault(),e.stopPropagation(),this.finishDrawing())}),document.addEventListener("click",e=>{if(!this.isEditMode||this.currentMode!=="text"||!this.pendingText)return;const t=e.target.closest(".page-overlay");if(!t)return;e.preventDefault(),e.stopPropagation();const i=parseInt(t.getAttribute("data-page"));this.addTextAtPosition(e,i,t)})}setPDFData(e){try{if(!e)return console.error("PDF data is empty"),!1;if(!(e instanceof Uint8Array))if(e instanceof ArrayBuffer)e=new Uint8Array(e);else if(ArrayBuffer.isView(e))e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);else return console.error("Unsupported data type:",typeof e),!1;return this.pdfData=new Uint8Array(e),this.annotations=[],this.history=[],this.historyIndex=-1,this.pageViewports.clear(),this.pageOverlays.clear(),console.log("PDF data set successfully"),!0}catch(t){return console.error("Error setting PDF data:",t),!1}}setPageViewport(e,t){const i={width:t.width,height:t.height,scale:t.scale||this.currentScale,dpr:t.dpr||1};this.pageViewports.set(e,i);const n=document.getElementById(`overlayCanvas-${e}`);n&&(this.pageOverlays.set(e,n),n.style.pointerEvents=this.isEditMode?"auto":"none")}enableEditMode(){console.log("Enabling edit mode"),this.isEditMode=!0,this.currentMode=null,this.pendingText=null,this.pageOverlays.forEach((e,t)=>{e&&(e.style.pointerEvents="auto",e.style.cursor="crosshair")}),document.querySelectorAll(".page-overlay").forEach(e=>{e.style.pointerEvents="auto",e.style.cursor="crosshair"})}disableEditMode(){console.log("Disabling edit mode"),this.isEditMode=!1,this.currentMode=null,this.pendingText=null,this.isDrawing=!1,this.drawingPoints=[],this.pageOverlays.forEach((e,t)=>{e&&(e.style.pointerEvents="none",e.style.cursor="default")}),document.querySelectorAll(".page-overlay").forEach(e=>{e.style.pointerEvents="none",e.style.cursor="default"})}setDrawingMode(e){if(!this.isEditMode){console.log("Cannot set drawing mode: edit mode disabled");return}e?(this.currentMode="draw",this.pendingText=null,this.isDrawing=!1,console.log("Drawing mode enabled")):(this.currentMode=null,console.log("Drawing mode disabled"))}setTextMode(e){if(!this.isEditMode){console.log("Cannot set text mode: edit mode disabled");return}this.currentMode="text",this.pendingText=e,this.isDrawing=!1,this.drawingPoints=[],console.log("Text mode enabled, click on PDF to place text")}setColor(e){console.log("Setting color to:",e),this.currentColor=e}startDrawing(e,t,i){const n=this.pageViewports.get(t);if(!n){console.error("Failed to get viewport for page:",t);return}e.preventDefault();const s=i.getBoundingClientRect(),r=e.clientX-s.left,l=e.clientY-s.top,a=this.canvasToRelative(r,l,n);this.isDrawing=!0,this.currentPage=t,this.drawingPoints=[[a.x,a.y]],console.log("Drawing started")}continueDrawing(e){if(!this.isDrawing)return;const t=this.pageViewports.get(this.currentPage);if(!t){console.error("No viewport for current page:",this.currentPage);return}const i=this.pageOverlays.get(this.currentPage);if(!i){console.error("No canvas for current page:",this.currentPage);return}e.preventDefault();const n=i.getBoundingClientRect(),s=e.clientX-n.left,r=e.clientY-n.top,l=this.canvasToRelative(s,r,t);if(this.drawingPoints.push([l.x,l.y]),this.drawingPoints.length>=2){const a=i.getContext("2d"),c=this.drawingPoints[this.drawingPoints.length-2],g=this.drawingPoints[this.drawingPoints.length-1],d=this.relativeToCanvas(c[0],c[1],t),h=this.relativeToCanvas(g[0],g[1],t);a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(h.x,h.y),a.strokeStyle=this.currentColor,a.lineWidth=this.currentBrushSize,a.lineCap="round",a.lineJoin="round",a.stroke()}}finishDrawing(){if(!this.isDrawing||this.drawingPoints.length<2){this.isDrawing=!1,this.drawingPoints=[];return}console.log("Finishing drawing"),this.saveToHistory(),this.annotations.push({type:"drawing",page:this.currentPage-1,points:[...this.drawingPoints],color:this.currentColor,width:this.currentBrushSize}),this.isDrawing=!1,this.drawingPoints=[],this.updateUndoRedoButtons()}addTextAtPosition(e,t,i){if(!this.pendingText){console.log("No pending text to add");return}const n=this.pageViewports.get(t);if(!n){console.error("Failed to get viewport for text on page:",t);return}const s=i.getBoundingClientRect(),r=e.clientX-s.left,l=e.clientY-s.top,a=this.canvasToRelative(r,l,n);console.log("Adding text at position:",{text:this.pendingText}),this.saveToHistory(),this.annotations.push({type:"text",page:t-1,x:a.x,y:a.y,text:this.pendingText,color:this.currentColor,fontSize:this.currentFontSize}),this.renderAnnotationsForPage(t),this.pendingText=null,this.currentMode=null,this.updateUndoRedoButtons()}renderAnnotationsForPage(e){const t=this.pageOverlays.get(e),i=this.pageViewports.get(e);if(!t||!i){console.warn("Cannot render annotations for page",e);return}const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height),this.annotations.filter(r=>r.page===e-1).forEach(r=>{r.type==="drawing"?this.renderDrawing(r,n,i):r.type==="text"&&this.renderText(r,n,i)})}renderDrawing(e,t,i){if(!e.points||e.points.length<2)return;const n=e.points[0],s=this.relativeToCanvas(n[0],n[1],i);t.beginPath(),t.moveTo(s.x,s.y);for(let r=1;r<e.points.length;r++){const l=e.points[r],a=this.relativeToCanvas(l[0],l[1],i);t.lineTo(a.x,a.y)}t.strokeStyle=e.color,t.lineWidth=e.width||this.currentBrushSize,t.lineCap="round",t.lineJoin="round",t.stroke()}renderText(e,t,i){const n=this.relativeToCanvas(e.x,e.y,i);t.font=`${e.fontSize||this.currentFontSize}px Arial`,t.fillStyle=e.color||this.currentColor,t.fillText(e.text,n.x,n.y)}canvasToRelative(e,t,i){if(!i)return{x:0,y:0};const n=e/i.width,s=1-t/i.height;return{x:n,y:s}}relativeToCanvas(e,t,i){if(!i)return{x:0,y:0};const n=e*i.width,s=(1-t)*i.height;return{x:n,y:s}}saveToHistory(){this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1)),this.history.push(JSON.parse(JSON.stringify(this.annotations))),this.historyIndex++,this.history.length>50&&(this.history.shift(),this.historyIndex--),this.updateUndoRedoButtons()}clearAll(){if(this.annotations.length===0){console.log("No annotations to clear");return}confirm("Hapus semua anotasi?")&&(console.log("Clearing all annotations"),this.saveToHistory(),this.annotations=[],this.pageOverlays.forEach((e,t)=>{e&&e.getContext("2d").clearRect(0,0,e.width,e.height)}),this.updateUndoRedoButtons())}async savePDF(){if(console.log("savePDF called"),!this.pdfData||this.pdfData.byteLength===0){alert("Belum ada PDF yang dimuat");return}if(this.annotations.length===0){alert("Tidak ada perubahan untuk disimpan");return}const e=document.getElementById("saveBtn"),t=(e==null?void 0:e.innerHTML)||"";e&&(e.innerHTML=`
                <div class="spinner" style="margin-right: 8px;"></div>
                Menyimpan...
            `,e.disabled=!0);try{const{PDFDocument:i,rgb:n}=await k(async()=>{const{PDFDocument:d,rgb:h}=await import("https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js");return{PDFDocument:d,rgb:h}},[]),s=await i.load(this.pdfData),r=await s.embedFont("Helvetica"),l=s.getPages();this.annotations.forEach(d=>{if(d.page>=l.length){console.warn("Annotation page out of bounds:",d.page);return}const h=l[d.page],m=h.getWidth(),v=h.getHeight();if(d.type==="text"){const y=d.x*m,p=d.y*v,f=this.hexToRgb(d.color);h.drawText(d.text,{x:y,y:p,size:d.fontSize||this.currentFontSize,font:r,color:n(f.r,f.g,f.b)})}else if(d.type==="drawing"){const y=this.hexToRgb(d.color);for(let p=0;p<d.points.length-1;p++){const f=d.points[p],b=d.points[p+1],L=f[0]*m,B=f[1]*v,F=b[0]*m,C=b[1]*v;h.drawLine({start:{x:L,y:B},end:{x:F,y:C},thickness:d.width||this.currentBrushSize,color:n(y.r,y.g,y.b)})}}});const a=await s.save(),g=`pdf-edited-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.pdf`;this.downloadFile(a,g),window.showNotification&&window.showNotification("PDF berhasil disimpan!","success")}catch(i){console.error("Error saving PDF:",i),alert("Gagal menyimpan PDF: "+i.message)}finally{e&&(e.innerHTML=t,e.disabled=!1)}}downloadFile(e,t){const i=new Blob([e],{type:"application/pdf"}),n=URL.createObjectURL(i),s=document.createElement("a");s.href=n,s.download=t,s.style.display="none",document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),URL.revokeObjectURL(n)},100)}hexToRgb(e){e=e.replace(/^#/,"");let t,i,n;return e.length===3?(t=parseInt(e[0]+e[0],16)/255,i=parseInt(e[1]+e[1],16)/255,n=parseInt(e[2]+e[2],16)/255):(t=parseInt(e.substring(0,2),16)/255,i=parseInt(e.substring(2,4),16)/255,n=parseInt(e.substring(4,6),16)/255),{r:t,g:i,b:n}}updateUndoRedoButtons(){}}class A{constructor(){this.pdfViewer=null,this.pdfEditor=null,this.isEditMode=!1,this.pdfLoaded=!1,console.log("PDF Editor App initialized"),this.init()}init(){try{this.pdfEditor=new S,this.pdfViewer=new T(this.pdfEditor),this.bindEvents(),console.log("App components initialized")}catch(e){console.error("Initialization failed:",e),this.showError("Gagal memulai aplikasi: "+e.message)}}bindEvents(){const e=document.getElementById("toggleEditBtn");e&&e.addEventListener("click",()=>this.toggleEditMode());const t=document.getElementById("drawBtn"),i=document.getElementById("textBtn"),n=document.getElementById("colorPicker"),s=document.getElementById("clearBtn"),r=document.getElementById("saveBtn");t&&t.addEventListener("click",()=>this.pdfEditor.setDrawingMode(!0)),i&&i.addEventListener("click",()=>this.showTextModal()),n&&n.addEventListener("change",g=>this.pdfEditor.setColor(g.target.value)),s&&s.addEventListener("click",()=>this.pdfEditor.clearAll()),r&&r.addEventListener("click",()=>this.pdfEditor.savePDF());const l=document.getElementById("cancelTextBtn"),a=document.getElementById("addTextBtn"),c=document.getElementById("textInput");l&&l.addEventListener("click",()=>this.hideTextModal()),a&&a.addEventListener("click",()=>{c&&c.value.trim()&&(this.pdfEditor.setTextMode(c.value.trim()),this.hideTextModal())}),c&&c.addEventListener("keypress",g=>{g.key==="Enter"&&(g.preventDefault(),a&&a.click())})}async handleFileUpload(e){if(console.log("Handling file upload:",e.name),!e||e.type!=="application/pdf"&&!e.name.toLowerCase().endsWith(".pdf")){this.showError("Hanya file PDF yang didukung");return}if(e.size>20*1024*1024){this.showError("Ukuran file maksimal 20MB");return}try{this.showLoading(!0),document.getElementById("emptyState").classList.add("hidden"),document.getElementById("pdfContainer").classList.remove("hidden"),document.getElementById("editModeToggle").classList.remove("hidden");const t=document.getElementById("fileInfo"),i=document.getElementById("fileName");t.classList.remove("hidden"),i.textContent=`${e.name} (${(e.size/1024).toFixed(0)} KB)`,this.isEditMode&&this.toggleEditMode(),await this.pdfViewer.loadPDF(e),this.pdfLoaded=!0,console.log("PDF loaded successfully")}catch(t){console.error("Error loading PDF:",t),this.showError("Gagal memuat PDF: "+t.message),this.pdfLoaded=!1,document.getElementById("emptyState").classList.remove("hidden"),document.getElementById("pdfContainer").classList.add("hidden"),document.getElementById("fileInfo").classList.add("hidden")}finally{this.showLoading(!1)}}toggleEditMode(){const e=document.getElementById("toolbar"),t=document.getElementById("toggleEditBtn");if(!this.pdfLoaded){this.showError("Upload PDF terlebih dahulu");return}this.isEditMode=!this.isEditMode,this.isEditMode?(e.classList.add("visible"),t.innerHTML=`
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M6 18L18 6M6 6l12 12"/>
                </svg>
            `,this.pdfEditor.enableEditMode(),console.log("Edit mode enabled")):(e.classList.remove("visible"),t.innerHTML=`
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
            `,this.pdfEditor.disableEditMode(),console.log("Edit mode disabled"))}showTextModal(){document.getElementById("textModal").classList.remove("hidden");const t=document.getElementById("textInput");t.value="",t.focus()}hideTextModal(){document.getElementById("textModal").classList.add("hidden")}showLoading(e){const t=document.getElementById("loadingOverlay");t&&t.classList.toggle("hidden",!e)}showError(e){if(console.error("Error:",e),window.showNotification){window.showNotification(e,"error");return}alert(e)}}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(o=>{console.log("ServiceWorker registered:",o.scope),o.addEventListener("updatefound",()=>{const e=o.installing;e.addEventListener("statechange",()=>{e.state==="installed"&&navigator.serviceWorker.controller&&(console.log("New service worker available"),u("Update tersedia! Refresh untuk update terbaru."))})})}).catch(o=>{console.log("ServiceWorker registration failed:",o)})});function x(){const o=document.getElementById("networkStatus"),e=document.getElementById("offlineWarning");navigator.onLine?(o.textContent="✅ Online",o.className="network-status online",e.classList.remove("show"),setTimeout(()=>{o.style.display="none"},3e3)):(o.textContent="❌ Offline",o.className="network-status offline",e.classList.add("show"))}window.addEventListener("online",x);window.addEventListener("offline",x);let w;const P=document.getElementById("installContainer"),U=document.getElementById("installButton");window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),w=o,P.classList.remove("hidden"),U.addEventListener("click",async()=>{if(!w)return;w.prompt();const{outcome:e}=await w.userChoice;e==="accepted"?(console.log("User accepted install"),P.classList.add("hidden")):console.log("User dismissed install"),w=null})});window.addEventListener("appinstalled",()=>{console.log("PWA installed"),P.classList.add("hidden"),w=null,document.documentElement.classList.add("pwa-mode")});(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(document.documentElement.classList.add("pwa-mode"),console.log("Running as PWA"));"launchQueue"in window&&"files"in LaunchParams.prototype&&(console.log("File Handling API supported"),launchQueue.setConsumer(async o=>{if(o.files&&o.files.length>0){console.log("File received via File Handling API:",o.files);for(const e of o.files)try{const t=await e.getFile();await E(t)}catch(t){console.error("Error opening file:",t),u("Gagal membuka file","error")}}}));function R(){const o=new URLSearchParams(window.location.search);if(o.has("shared")&&(console.log("Shared file detected, loading from IndexedDB"),O()),o.has("file")){const e=o.get("file");console.log("File URL detected:",e),$(e)}if(o.has("source")){const e=o.get("source");if(console.log("App opened from source:",e),window.history.replaceState){const t=window.location.pathname;window.history.replaceState({},document.title,t)}}}async function E(o){console.log("Opening file:",o.name,o.type,o.size);const e=document.getElementById("fileHandlingStatus");if(e.textContent=`Membuka: ${o.name}`,e.style.display="block",o.type!=="application/pdf"&&!o.name.toLowerCase().endsWith(".pdf")){u("Hanya file PDF yang didukung","error"),e.style.display="none";return}document.getElementById("loadingOverlay").classList.remove("hidden");try{if(window.pdfEditorApp)await window.pdfEditorApp.handleFileUpload(o);else{const t=new DataTransfer;t.items.add(o),document.getElementById("pdfUpload").files=t.files;const i=new Event("change");document.getElementById("pdfUpload").dispatchEvent(i)}setTimeout(()=>{u(`File "${o.name}" berhasil dibuka`),e.style.display="none"},1e3)}catch(t){console.error("Error handling file:",t),u(`Gagal membuka file: ${t.message}`,"error"),e.style.display="none"}finally{document.getElementById("loadingOverlay").classList.add("hidden")}}async function O(){try{const o=await H(),i=await o.transaction("sharedFiles","readonly").objectStore("sharedFiles").getAll();if(i.length>0){const n=i.sort((a,c)=>c.id-a.id)[0],s=new File([n.data],n.name,{type:n.type,lastModified:new Date(n.date).getTime()});await E(s),await o.transaction("sharedFiles","readwrite").objectStore("sharedFiles").delete(n.id)}}catch(o){console.error("Error loading shared file:",o),u("Gagal memuat file yang dibagikan","error")}}async function $(o){try{const e=document.getElementById("fileHandlingStatus");e.textContent="Mengunduh file...",e.style.display="block";const t=await fetch(o);if(!t.ok)throw new Error(`HTTP ${t.status}`);const i=await t.blob(),n=o.split("/").pop()||"document.pdf",s=new File([i],n,{type:"application/pdf"});await E(s)}catch(e){console.error("Error loading file from URL:",e),u(`Gagal mengunduh file: ${e.message}`,"error")}}function H(){return new Promise((o,e)=>{const t=indexedDB.open("PDFEditorFiles",2);t.onupgradeneeded=i=>{const n=i.target.result;n.objectStoreNames.contains("sharedFiles")||n.createObjectStore("sharedFiles",{keyPath:"id"})},t.onsuccess=i=>o(i.target.result),t.onerror=i=>e(i.target.error)})}function u(o,e="info"){const t=document.createElement("div");t.className=`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 ${e==="error"?"bg-red-500":e==="success"?"bg-green-500":"bg-blue-500"} text-white`,t.innerHTML=`
                <div class="flex items-center">
                    ${e==="error"?"❌":e==="success"?"✅":"ℹ️"}
                    <span class="ml-2">${o}</span>
                </div>
            `,document.body.appendChild(t),setTimeout(()=>{t.classList.remove("translate-x-full")},10),setTimeout(()=>{t.classList.add("translate-x-full"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},300)},3e3)}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing PDF Editor App"),x(),R(),window.pdfEditorApp=new A,window.handleOpenedFile=E,window.showNotification=u});document.addEventListener("keydown",o=>{if(o.ctrlKey&&o.shiftKey&&o.key==="D"){const e=document.getElementById("debugInfo");e.style.display=e.style.display==="none"?"block":"none",console.log("Debug mode toggled")}});window.addEventListener("beforeunload",()=>{if(window.history.replaceState){const o=window.location.pathname;window.history.replaceState({},document.title,o)}});
